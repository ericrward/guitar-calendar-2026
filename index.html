<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2026 Calendar</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .day-btn { transition: background-color 0.15s; }
  </style>
</head>
<body class="min-h-screen bg-slate-50 p-4">
  <div class="flex justify-center items-center gap-4 mb-2">
    <h1 class="text-3xl font-bold text-center text-slate-800">2026 Calendar</h1>
    <span id="sync-status" class="text-sm px-2 py-1 rounded bg-gray-200 text-gray-600">Loading...</span>
  </div>
  <p class="text-center text-slate-500 mb-6 text-sm">Click a day to cycle: unmarked → green → red → unmarked</p>
  
  <div id="calendar" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 max-w-7xl mx-auto"></div>
  
  <div class="flex justify-center gap-6 mt-6 text-sm text-slate-600">
    <div class="flex items-center gap-2">
      <div class="w-4 h-4 rounded bg-emerald-500"></div>
      <span>Green</span>
    </div>
    <div class="flex items-center gap-2">
      <div class="w-4 h-4 rounded bg-red-500"></div>
      <span>Red</span>
    </div>
    <div class="flex items-center gap-2">
      <div class="w-4 h-4 rounded bg-gray-100 border border-gray-300"></div>
      <span>Unmarked</span>
    </div>
  </div>

  <div id="setup-message" class="hidden max-w-xl mx-auto mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-sm text-slate-700">
  </div>

  <script>
    // ========== CONFIGURATION ==========
    const API_KEY = '$2a$10$eHztB0M4YWCkHR5yp/Mo6OrZPSXuZYN/MiBLwU1ePbl0HITyWY3sC';
    const BIN_ID = ''; // Leave empty on first run - will be filled in after setup
    // ===================================

    const months = [
      { name: 'January', days: 31, startDay: 4 },
      { name: 'February', days: 28, startDay: 0 },
      { name: 'March', days: 31, startDay: 0 },
      { name: 'April', days: 30, startDay: 3 },
      { name: 'May', days: 31, startDay: 5 },
      { name: 'June', days: 30, startDay: 1 },
      { name: 'July', days: 31, startDay: 3 },
      { name: 'August', days: 31, startDay: 6 },
      { name: 'September', days: 30, startDay: 2 },
      { name: 'October', days: 31, startDay: 4 },
      { name: 'November', days: 30, startDay: 0 },
      { name: 'December', days: 31, startDay: 2 },
    ];

    const weekDays = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
    let dayColors = {};
    let saveTimeout = null;

    function setStatus(text, color) {
      const status = document.getElementById('sync-status');
      status.textContent = text;
      status.className = `text-sm px-2 py-1 rounded ${color}`;
    }

    function getColorClasses(color) {
      if (color === 'green') return 'bg-emerald-500 text-white';
      if (color === 'red') return 'bg-red-500 text-white';
      return 'bg-gray-100 hover:bg-gray-200 text-gray-700';
    }

    async function createBin() {
      const response = await fetch('https://api.jsonbin.io/v3/b', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-Master-Key': API_KEY,
          'X-Bin-Name': 'calendar-2026'
        },
        body: JSON.stringify({})
      });
      const data = await response.json();
      return data.metadata.id;
    }

    async function loadData() {
      if (!BIN_ID) {
        // First time setup - create a new bin
        setStatus('Setting up...', 'bg-yellow-200 text-yellow-800');
        try {
          const newBinId = await createBin();
          const msg = document.getElementById('setup-message');
          msg.classList.remove('hidden');
          msg.innerHTML = `
            <p class="font-bold text-yellow-800 mb-2">⚠️ One more step to finish setup!</p>
            <p class="mb-2">Your data bin has been created. To complete setup:</p>
            <ol class="list-decimal list-inside space-y-1 mb-3">
              <li>Go to your GitHub repository</li>
              <li>Click on <strong>index.html</strong> to open it</li>
              <li>Click the <strong>pencil icon</strong> (Edit this file)</li>
              <li>Find the line that says <code class="bg-yellow-100 px-1">const BIN_ID = '';</code></li>
              <li>Change it to: <code class="bg-yellow-100 px-1">const BIN_ID = '${newBinId}';</code></li>
              <li>Click <strong>"Commit changes"</strong></li>
              <li>Wait 1-2 minutes, then refresh this page</li>
            </ol>
            <p class="text-xs text-slate-500">Your Bin ID: <code class="select-all bg-yellow-100 px-1">${newBinId}</code></p>
          `;
          setStatus('Setup needed', 'bg-yellow-200 text-yellow-800');
        } catch (err) {
          setStatus('Setup error', 'bg-red-200 text-red-800');
          console.error(err);
        }
        return;
      }

      try {
        const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
          headers: { 'X-Master-Key': API_KEY }
        });
        const data = await response.json();
        dayColors = data.record || {};
        setStatus('Synced ✓', 'bg-green-200 text-green-800');
        refreshAllButtons();
      } catch (err) {
        setStatus('Load error', 'bg-red-200 text-red-800');
        console.error(err);
      }
    }

    async function saveData() {
      if (!BIN_ID) return;
      setStatus('Saving...', 'bg-blue-200 text-blue-800');
      try {
        await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'X-Master-Key': API_KEY
          },
          body: JSON.stringify(dayColors)
        });
        setStatus('Synced ✓', 'bg-green-200 text-green-800');
      } catch (err) {
        setStatus('Save error', 'bg-red-200 text-red-800');
        console.error(err);
      }
    }

    function scheduleSave() {
      if (saveTimeout) clearTimeout(saveTimeout);
      setStatus('Saving...', 'bg-blue-200 text-blue-800');
      saveTimeout = setTimeout(saveData, 500);
    }

    function handleClick(monthIndex, day) {
      const key = `${monthIndex}-${day}`;
      const current = dayColors[key];
      
      if (!current) {
        dayColors[key] = 'green';
      } else if (current === 'green') {
        dayColors[key] = 'red';
      } else {
        delete dayColors[key];
      }
      
      updateButton(monthIndex, day);
      scheduleSave();
    }

    function updateButton(monthIndex, day) {
      const key = `${monthIndex}-${day}`;
      const btn = document.getElementById(`day-${key}`);
      if (!btn) return;
      const color = dayColors[key];
      btn.className = `day-btn aspect-square rounded flex items-center justify-center text-sm font-medium cursor-pointer ${getColorClasses(color)}`;
    }

    function refreshAllButtons() {
      months.forEach((month, monthIndex) => {
        for (let day = 1; day <= month.days; day++) {
          updateButton(monthIndex, day);
        }
      });
    }

    function renderCalendar() {
      const container = document.getElementById('calendar');
      
      months.forEach((month, monthIndex) => {
        const monthDiv = document.createElement('div');
        monthDiv.className = 'bg-white rounded-lg shadow-md p-3';
        
        let html = `
          <h2 class="text-lg font-semibold text-slate-700 mb-2 text-center">${month.name}</h2>
          <div class="grid grid-cols-7 gap-1 mb-1">
            ${weekDays.map(d => `<div class="text-center text-xs font-medium text-slate-400 py-1">${d}</div>`).join('')}
          </div>
          <div class="grid grid-cols-7 gap-1">
        `;
        
        for (let i = 0; i < month.startDay; i++) {
          html += `<div class="aspect-square"></div>`;
        }
        
        for (let day = 1; day <= month.days; day++) {
          const key = `${monthIndex}-${day}`;
          const color = dayColors[key];
          html += `
            <button 
              id="day-${key}"
              onclick="handleClick(${monthIndex}, ${day})"
              class="day-btn aspect-square rounded flex items-center justify-center text-sm font-medium cursor-pointer ${getColorClasses(color)}"
            >${day}</button>
          `;
        }
        
        html += '</div>';
        monthDiv.innerHTML = html;
        container.appendChild(monthDiv);
      });
    }

    renderCalendar();
    loadData();
  </script>
</body>
</html>
